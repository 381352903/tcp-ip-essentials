## 4.6 RIP exercises

In this section, we will examine the operation of RIP.

For this experiment, we will use a topology with four routers in a ring, and a host connected to each LAN.

To set up this topology in the GENI Portal, create a slice, click on "Add Resources", and load the RSpec from the following URL: https://raw.githubusercontent.com/ffund/tcp-ip-essentials/master/lab4/lab4-dynamic-routing.xml

Then bind to an InstaGENI site and reserve your resources. Wait for them to become available for login ("turn green" on your canvas). This RSpec also defines a configuration script that runs when each host boots, so after the resources "turn green", wait a few more minutes beyond that for the configuration script to finish running. Then SSH into each, using the details given in the GENI Portal.

Before you start, use `ifconfig -a` to capture the network interface configuration of each host and router in this topology. Save this for your lab report.

On boot, each workstation and router will only have routing rules for subnets that it directly connects to (and for the control interface). It will not have routing rules for other subnets in the experiment topology. Confirm this with

```
route -n
```

### Exercise 2

The virtual routers in our experiment are running `quagga`, a software router that includes a shell interface similar to the Cisco IOS interface. Open the shell interface on each router with:

```
export VTYSH_PAGER=more
sudo vtysh
```

(If you get an error message `sudo: vtysh: command not found` or `Exiting: failed to connect to any daemons` at this point, the configuration script hasn't finished running! Wait a few minutes for it to finish.)

In the `quagga` shell, run

```
show ip route
```

to see what routes are currently configured on each router. Save this output.

Using this shell interface, we can configure the routers to use the RIP protocol.

First, enter Global Configuration mode in each router:


```
configure terminal
```

The prompt should change (to include a `(config)` at the end), indicating that you are now in configuration mode.

Then, type

```
router rip
```

to enable RIP. Finally, you need to associate one or more networks to the RIP routing process. Run

```
network 10.10.0.0/16
```

so that all addresses from 10.10.0.0-10.10.255.255 will be enabled for RIP. (Note: this syntax is slightly different in `quagga` then in Cisco IOS.) Then run `exit` twice, until you are back in the regular `quagga` shell (not in config mode).

RIPv2 multicasts its routing table every 30 seconds to the multicast IP address 224.0.0.9. On the workstations in each network segment (romeo, hamlet, othello, petruchio), run

```
sudo tcpdump -en -i eth1 -w $(hostname -s)-rip.pcap
```

for about a minute or two, to capture these messages.

Then, run

```
show ip route
```

in the `quagga` shell on each router, to see the new routes, and save the output. 


Also see RIP-specific information in the `quagga` shell on each router with 

```
show ip rip
```

Note that the "Metric" column here shows the hop count to each destination network. Save all outputs.

After a few minutes, you can stop the `tcpdump` processes on the workstations with Ctrl+C. Transfer these to your laptop with `scp`, or play them back with `tcpdump` using:

```
sudo tcpdump -r $(hostname -s)-rip.pcap -env
```

**Lab report**: Show the RIP messages received by router 4. Using these RIP messages, draw the distance table and the routing table at router 4, assuming that number of hops is used as the metric. Compare to the output of `show ip rip` and `show ip route` at router 4.

### Exercise 3

In this exercise, we will examine how RIP reponds to link failures. 

Start `tcpdump` on each of the four workstations (romeo, hamlet, othello, petruchio) with

```
sudo tcpdump -i eth1 -w $(hostname -s)-rip-failure.pcap
```

Let these run during this exercise.


On each of the routers, in the `quagga` shell, run

```
show ip rip
```

to see the current RIP database. Save the output.

On router 1, use the

```
ifconfig
```

output to idenfity the name of the interface that has the address 10.10.62.1 (e.g. `eth1` or `eth2`). This is the interface that connects Router 1 to the network segment that Router 2 is on. You will use this interface name in the following commands. 

Then, on Router 1, use the `quagga` shell to bring down this interface. Run

```
configure terminal
interface eth1
shutdown
```

(or substitute `eth2` if that is the name of the interface with address 10.10.62.1). Then run `exit` twice to return to the regular `quagga` shell.


Keep running


```
show ip rip
```

on each router, and watch as the routing tables are updated to remove routes via 10.10.62.1

Once there are no more routes that go through 10.10.62.1, get the routing tables on all four routers again with 

```
show ip rip
```

and save the output. Then, in the `quagga` shell on Router 1, run

```
configure terminal
interface eth1
no shutdown
```

(or substitute `eth2` if that is the name of the interface with address 10.10.62.1) to bring back up the disabled interface. Also, run `exit` twice until you return to the regular `quagga` shell.

Wait a few minutes, then run


```
show ip rip
```

on all four routers, and save the output.


**Lab report**: Show the RIP tables you captured at each stage of this exercise. Explain how the routing tables changed when the most direct path between Router 1 and Router 2 was disabled.


Once you are done with this part of the lab , proceed to the [next part](el5373-lab4-47.md).
